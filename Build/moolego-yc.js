var UI={props:{}};var ui={version:"0.2",build:"%build%",defaultSkin:"AquaGraphite"};ui.controller={};UI.Paint=new Class({Implements:[Events,Options],options:{props:{},width:300,height:150,zIndex:-1,context:"2d",debug:false,onComplete:$empty},initialize:function(a){this.setOptions(a);this.props=this.options.props;this.build();this.setSize();this.draw()},build:function(){this.canvas=new Element("canvas",{styles:{position:"absolute",zIndex:this.options.zIndex}});this.ctx=this.canvas.getContext(this.options.context)},setSize:function(c,a,b){if(b){this.props=b}if(this.props.layers.base&&this.props.layers.base.shadow&&this.props.layers.base.shadow){this.shadowSize=this.props.layers.base.shadow.size;if(!this.props.layers.base.shadow.offsetX){this.props.layers.base.shadow.offsetX=0}if(!this.props.layers.base.shadow.offsetY){this.props.layers.base.shadow.offsetY=0}this.shadowOffset=[this.props.layers.base.shadow.offsetX,this.props.layers.base.shadow.offsetY]}else{this.shadowSize=0;this.shadowOffset=[0,0]}this.canvasSize=[(c||this.options.width)+this.shadowSize*2+Math.abs(this.shadowOffset[0]),(a||this.options.height)+this.shadowSize*2+Math.abs(this.shadowOffset[1])];this.canvas.setProperties({width:this.canvasSize[0],height:this.canvasSize[1]});this.canvas.setStyles({top:-this.shadowSize,left:-this.shadowSize,width:this.canvasSize[0],height:this.canvasSize[1]});this.absSize=[this.canvasSize[0]-this.shadowSize*2-Math.abs(this.shadowOffset[0]),this.canvasSize[1]-this.shadowSize*2-Math.abs(this.shadowOffset[1])];this.relSize=this.absSize;this.offset=[this.shadowSize,this.shadowSize];if(c&&a){this.draw()}},draw:function(a){this.processLayers(a);this.offset=[this.shadowSize,this.shadowSize];this.relSize=[this.canvasSize[0]-this.shadowSize*2-Math.abs(this.shadowOffset[0]),this.canvasSize[1]-this.shadowSize*2-Math.abs(this.shadowOffset[1])];this.fireEvent("complete")},processLayers:function(){var a=new Hash(this.props.layers);if(this.props.layers.def){this.props.layers.def.each(function(b){this.trace(b)},this)}else{a.each(function(c,b){this.trace(b)},this)}},trace:function(b){if(b!="default"&&b!="def"&&b!="shadow"){var a=this.getProperties(b);if(this.options.debug){console.log(b+":",a)}this.ctx.save();this.setTransformation(a);switch(a.shape){case"circle":this.circle(a);break;case"roundedRect"||"roundRect":this.roundedRect(a);break;case"line"||"lineDown":a.direction="down";this.line(a);break;case"lineUp":a.direction="up";this.line(a);break;case"triangle":this.triangle(a);break;case"complex":this.complex(a);break}this.drawShape(a);this.ctx.restore()}},convert2Px:function(b,c,d){c=(c=="x")?0:1;var a=d?this.absSize[c]:this.relSize[c];if($type(b)=="string"){if(b.match(/%$/)){return b.toInt()/100*a}else{if(b.match(/px$/)){return b.toInt()}else{if(b=="auto"){return b}}}}else{return b}},setOffset:function(f,c,d){var h=(c=="relative")?false:true;f=[this.convert2Px(f[0],"y",h),this.convert2Px(f[1],"x",h),this.convert2Px(f[2],"y",h),this.convert2Px(f[3],"x",h)];if(d){if($type(d)=="array"&&d[1]&&d[0]=="auto"&&d[1]!="auto"){d[1]=this.convert2Px(d[1],"y",h)}else{if($type(d)=="array"&&d[1]&&d[0]!="auto"&&d[1]=="auto"){d[0]=this.convert2Px(d[0],"x",h)}else{if($type(d)=="array"&&d[1]&&d[0]!="auto"&&d[1]!="auto"){d[0]=this.convert2Px(d[0],"x",h);d[1]=this.convert2Px(d[1],"y",h)}else{if($type(d)=="array"&&d[1]&&d[0]=="auto"&&d[1]=="auto"){d=false}else{if(d!="auto"){d=[this.convert2Px(d,"x",h),this.convert2Px(d,"y",h)]}}}}}}var b,g,e,a;if(!d){if(h){b=f[3]+this.shadowSize;g=f[0]+this.shadowSize;e=this.absSize[0]-f[1]-f[3];a=this.absSize[1]-f[0]-f[2]}else{b=this.offset[0]+f[3];g=this.offset[1]+f[0];e=this.relSize[0]-f[1]-f[3];a=this.relSize[1]-f[0]-f[2];this.offset=[b,g];this.relSize=[e,a]}}else{switch(true){case f[3]!="auto":if(h){e=(d[0]=="auto")?this.absSize[0]-f[1]-f[3]:d[0];b=f[3]+this.shadowSize}else{e=(d[0]=="auto")?this.relSize[0]-f[1]-f[3]:d[0];b=this.offset[0]+f[3];this.offset[0]=b;this.relSize[0]=e}break;case f[1]!="auto":if(h){e=(d[0]=="auto")?this.absSize[0]-f[1]-f[3]:d[0];b=this.absSize[0]-e-f[1]+this.shadowSize}else{e=(d[0]=="auto")?this.relSize[0]-f[1]-f[3]:d[0];b=this.offset[0]+this.relSize[0]-e-f[1];this.offset[0]=b;this.relSize[0]=e}break;case f[3]=="auto"&&f[1]=="auto":if(h){e=d[0];b=(this.absSize[0]-e)/2+this.shadowSize}else{e=d[0];b=(this.relSize[0]-e)/2;this.offset[0]=b;this.relSize[0]=e}break}switch(true){case f[0]!="auto":if(h){a=(d[1]=="auto")?this.absSize[1]-f[0]-f[2]:d[1];g=f[0]+this.shadowSize}else{a=(d[1]=="auto")?this.relSize[1]-f[0]-f[2]:d[1];g=this.offset[1]+f[0];this.offset[1]=g;this.relSize[1]=a}break;case f[2]!="auto":if(h){a=(d[1]=="auto")?this.absSize[1]-f[0]-f[2]:d[1];g=this.absSize[1]-a-f[2]+this.shadowSize}else{a=(d[1]=="auto")?this.relSize[1]-f[0]-f[2]:d[1];g=this.offset[1]+this.relSize[1]-a-f[2];this.offset[1]=g;this.relSize[1]=a}break;case f[0]=="auto"&&f[2]=="auto":if(h){a=d[1];g=(this.absSize[1]-a)/2+this.shadowSize}else{e=d[1];g=(this.relSize[1]-a)/2;this.offset[1]=g;this.relSize[1]=a}break}}return[b,g,e,a]},getProperties:function(c){var b={position:$pick(this.props.layers[c].position,this.props.layers["default"].position),size:$pick(this.props.layers[c].size,this.props.layers["default"].size),shape:$pick(this.props.layers[c].shape,this.props.layers["default"].shape),color:$pick(this.props.layers[c].color,this.props.layers["default"].color),gradient:$pick(this.props.layers[c].gradient,this.props.layers["default"].gradient),stroke:$pick(this.props.layers[c].stroke,this.props.layers["default"].stroke),image:$pick(this.props.layers[c].image,this.props.layers["default"].image),width:$pick(this.props.layers[c].width,this.props.layers["default"].width),opacity:$pick(this.props.layers[c].opacity,this.props.layers["default"].opacity),angle:$pick(this.props.layers[c].angle,this.props.layers["default"].angle),rotation:$pick(this.props.layers[c].rotation,this.props.layers["default"].rotation),scale:$pick(this.props.layers[c].scale,this.props.layers["default"].scale),composite:$pick(this.props.layers[c].composite,this.props.layers["default"].composite),def:$pick(this.props.layers[c].def,this.props.layers["default"].def),baseSize:$pick(this.props.layers[c].baseSize,this.props.layers["default"].baseSize),shadow:$pick(this.props.layers[c].shadow,this.props.layers["default"].shadow)};var d=$pick(this.props.layers[c].offset,this.props.layers["default"].offset);if($type(d)=="array"){if($defined(d[3])){d=this.setOffset(d,b.position,b.size)}else{if($defined(d[2])){d=this.setOffset([d[0],d[1],d[2],d[1]],b.position,b.size)}else{d=this.setOffset([d[0],d[1],d[0],d[1]],b.position,b.size)}}}else{d=this.setOffset([d,d,d,d],b.position,b.size)}b.offset=[d[0],d[1]];b.size=[d[2],d[3]];var a=$pick(this.props.layers[c].radius,this.props.layers["default"].radius);if($type(a)=="array"){b.radius=$defined(a[3])?a:[a[0],a[0],a[1],a[1]]}else{b.radius=[a,a,a,a]}return b},setColor:function(r,k){var o,n,y,v,g,e,s;var q=(r=="fill")?"gradient":"stroke";if(!k[q]){k[q]={color:k.color,opacity:k.opacity||1}}if(k[q]&&$type(k[q].color)=="array"){if(k[q].type!="radial"){if(!$defined(k[q].angle)){k[q].angle=90}var A=k[q].angle*Math.PI/180;var m=Math.abs(A);var d=k.size[0];var c=k.size[1];this.ctx.ratio=k.size[1]/k.size[0];this.ctx.angle=A;if(k[q].angle>=-90&&k[q].angle<90){o=-((Math.cos(A-Math.atan(c/d))*Math.sqrt(Math.pow(d,2)+Math.pow(c,2))*Math.cos(A))/2);n=-((Math.cos(A-Math.atan(c/d))*Math.sqrt(Math.pow(d,2)+Math.pow(c,2))*Math.sin(A))/2)}else{o=((Math.cos(Math.PI-A-Math.atan(c/d))*Math.sqrt((d).pow(2)+(c).pow(2))*Math.cos(Math.PI-A))/2);n=-((Math.cos(Math.PI-A-Math.atan(c/d))*Math.sqrt((d).pow(2)+(c).pow(2))*Math.sin(Math.PI-A))/2)}y=-o;v=-n;s=this.ctx.createLinearGradient(o,n,y,v)}else{g=k.size[0]/2;e=k.size[1]/2;var z,j,w;if(k[q].startCircle){z=this.convert2Px(k[q].startCircle[0],"x")-g;j=this.convert2Px(k[q].startCircle[1],"y")-e;w=this.convert2Px(k[q].startCircle[2],"x")}else{z=0;j=0;w=0}var x,f,u;if(k[q].endCircle){x=this.convert2Px(k[q].endCircle[0],"x")-g;f=this.convert2Px(k[q].endCircle[1],"y")-e;u=this.convert2Px(k[q].endCircle[2],"x")/2}else{x=0;f=0;u=this.relSize[0]/2}s=this.ctx.createRadialGradient(z,j,w,x,f,u)}var t;var l=k[q].color.length;if(!k[q].opacity||$type(k[q].opacity)!="array"){var h=k[q].opacity||1;k[q].opacity=[];for(t=0;t<l;t++){k[q].opacity[t]=h}}if(!k[q].stop){k[q].stop=[];for(t=0;t<l;t++){k[q].stop[t]=t*(1/(l-1))}}for(t=0;t<l;t++){var b="rgba("+k[q].color[t].hexToRgb(true).join(",")+", "+k[q].opacity[t]+")";s.addColorStop(k[q].stop[t],b)}}else{k[q].opacity=k[q].opacity||1;s="rgba("+k[q].color.hexToRgb(true).join(",")+","+k[q].opacity+")"}this.ctx[r+"Style"]=s},setTransformation:function(a){if(a.shape!="complex"){this.ctx.translate(a.size[0]/2+a.offset[0],a.size[1]/2+a.offset[1])}if(a.rotation){this.ctx.rotate(Math.PI*a.rotation/180)}if(a.scale){if($type(a.scale)!="array"){a.scale=[a.scale,a.scale]}this.ctx.scale(a.scale[0],a.scale[1])}if(a.composite){this.ctx.globalCompositeOperation=a.composite}},drawShape:function(a){if(a.shadow){this.setShadow(a.shadow)}if(a.image){this.setImage(a)}if(a.color||a.gradient){this.setColor("fill",a);this.ctx.fill()}if(a.stroke){this.ctx.lineWidth=(a.stroke.width)?a.stroke.width:1;this.setColor("stroke",a);this.ctx.stroke()}},setShadow:function(d){var b=d.opacity||1;var a=d.color||"#000000";var c="rgba("+a.hexToRgb(true).join(",")+", "+b+")";this.ctx.shadowColor=c;this.ctx.shadowOffsetX=d.offsetX||0;this.ctx.shadowOffsetY=d.offsetY||0;this.ctx.shadowBlur=d.blur||0},setImage:function(b){var c=this;b.image.pattern=b.image.pattern||"repeat";var a=new Image();a.onload=function(){var d=c.ctx.createPattern(a,b.image.pattern);c.ctx.fillStyle=d;c.ctx.fill()};a.src=b.image.url},roundedRect:function(e){var i=e.size[0];var h=e.size[1];var g=i/2;var f=h/2;var d=e.radius[0];var c=e.radius[1];var b=e.radius[2];var a=e.radius[3];this.ctx.beginPath();this.ctx.moveTo(d-g,-f);this.ctx.lineTo(i-c-g,-f);this.ctx.quadraticCurveTo(i-g,-f,i-g,c-f);this.ctx.lineTo(i-g,h-b-f);this.ctx.quadraticCurveTo(i-g,h-f,i-b-g,h-f);this.ctx.lineTo(a-g,h-f);this.ctx.quadraticCurveTo(-g,h-f,-g,h-a-f);this.ctx.lineTo(-g,d-f);this.ctx.quadraticCurveTo(-g,-f,d-g,-f);this.ctx.closePath()},circle:function(f){f.angle=f.angle||[0,360];var d=0;var h=0;var g=f.size[1]/2;var c=Math.PI*f.angle[0]/180;var e=Math.PI*f.angle[1]/180;this.ctx.beginPath();this.ctx.arc(d,h,g,e,c,true);this.ctx.closePath()},line:function(c){c.stroke=c.stroke||{color:c.color,width:c.width};delete c.color;var b=c.size[0]/2;var a=c.size[1]/2;this.ctx.beginPath();if(c.direction=="up"){this.ctx.moveTo(-b+0.5,a-0.5);this.ctx.lineTo(b-0.5,-a+0.5)}else{this.ctx.moveTo(-b+0.5,-a+0.5);this.ctx.lineTo(b-0.5,a-0.5)}},triangle:function(c){var b=c.size[0]/2;var a=c.size[1]/2;this.ctx.beginPath();this.ctx.moveTo(-b,a);this.ctx.lineTo(b,a);this.ctx.lineTo(0,-a);this.ctx.closePath()},complex:function(c){var b=this.ctx;var a=c.size[0]/c.baseSize[0]||100;var d=c.size[1]/c.baseSize[1]||100;b.beginPath();c.def.each(function(f){var g=[];var e=0;var h;f.each(function(i){if(e===0){h=i}else{if((e%2)===0){if(h!="arc"){g[e]=i*d}else{g[e]=i}}else{if(h!="arc"){g[e]=i*a}else{g[e]=i}}}e++});switch(h){case"moveTo":b.moveTo(g[1],g[2]);break;case"lineTo":b.moveTo(g[1],g[2]);break;case"arc":g[1]=g[1]*a;g[2]=g[2]*d;g[3]=g[3]*(d+a)/2;b.arc(g[1],g[2],g[3],g[4],g[5],g[6]);break;case"quadraticCurveTo":b.quadraticCurveTo(g[1],g[2],g[3],g[4]);break;case"bezierCurveTo":b.bezierCurveTo(g[1],g[2],g[3],g[4],g[5],g[6]);break}});b.closePath()},inject:function(b,a){this.canvas.inject(b,a);return this}});UI.Skin=new Class({Implements:[Events,Options],options:{skin:"AquaGraphite"},initialize:function(a){this.setOptions(a);this.defaultSkin=this.options.skin;return this},processSkin:function(b){var a,c,e,d;for(a in UI.props[b]){if(a!="default"){for(c in UI.props[b][a]){for(e in UI.props[b][a][c]){if(e!="shortcuts"){d=UI.props[b]["default"];if(UI.props[b][a]["default"]){d=this.merge(d,UI.props[b][a]["default"]["default"],UI.props[b][a]["default"][e])}d=this.merge(d,UI.props[b][a][c]["default"],UI.props[b][a][c][e]);UI.props[b][a][c][e]=d}}}}}UI.props[b].preprocessed=true},get:function(className){var skin=className.options.skin?className.options.skin:this.defaultSkin,cKey=className.options.component,tKey=className.options.type,props=className.options.props,styles=className.options.styles;if(!UI.props[skin].preprocessed){this.processSkin(skin)}var type;if(UI.props[skin][cKey][tKey]){type=$unlink(UI.props[skin][cKey][tKey])}else{if(UI.props[skin][cKey]["default"]){type=$unlink(UI.props[skin][cKey]["default"])}else{type={"default":$unlink(UI.props[skin]["default"])}}}for(var csKey in props){if(!type[csKey]){type[csKey]=props[csKey]}}for(var sKey in type){if(type[sKey].shortcuts){for(var scKey in type[sKey].shortcuts){if(className.options[scKey]){eval("type['"+sKey+"']."+type[sKey].shortcuts[scKey]+" = this.merge(type['"+sKey+"']."+type[sKey].shortcuts[scKey]+",className.options."+scKey+")")}}}if(props){type[sKey]=this.merge(type[sKey],props["default"],props[sKey])}type[sKey].styles=this.merge(type[sKey].styles,styles)}return type},getComponentProps:function(c,b){var a={};$H(c).each(function(e,d){if(e.components&&e.components[b]){a[d]=e.components[b]}});return a},merge:function(){var e={};for(var d=0,a=arguments.length;d<a;d++){var b=arguments[d];for(var c in b){var g=b[c],f=e[c];e[c]=($type(g)=="object"&&$type(f)=="object")?this.merge(f,g):g}}return e}});UI.Element=new Class({Implements:[Events,Options],options:{lib:"ui",component:"element",type:"default",state:"default",props:false,skin:false,styles:{},group:false,className:false,useAutoClass:true,tag:"span",selectable:true,draggable:false,dragLimitX:false,dragLimitY:false,resizable:false,resizeLimitX:[100,Window.getWidth()],resizeLimitY:[100,Window.getHeight()]},initialize:function(a){this.setOptions(a);this.state=this.options.state;this.dragHandlers=[];this.setClassName();this.setSkin();this.build();this.setBehavior()},toElement:function(){return this.element},build:function(){this.fireEvent("build");this.element=new Element(this.options.tag,{"class":this.className,styles:this.props.styles,events:this.options.events,id:this.options.id,name:this.options.name,html:this.options.html,"for":this.options["for"]});if(!this.options.selectable){this.element.disableSelect()}if(this.options.resizable){this.buildResizer()}},buildResizer:function(){this.resizer=new UI.Element({skin:this.options.skin,component:"element",type:"resizer",styles:{zIndex:"1000000",bottom:this.element.getComputedSize().computedBottom,right:this.element.getComputedSize().computedRight}}).inject(this.element,"bottom");this.resizer.element.addEvent("click",function(b){var a=new Event(b).stop()})},setClassName:function(){if(this.options.className){this.className=this.options.className}else{if(this.options.useAutoClass){this.className=this.options.lib+"-"+this.options.component;if(this.options.type!="default"){this.className=this.className+"-"+this.options.type}if(this.options.state!="default"){this.className=this.className+"-"+this.options.state}}}},setSkin:function(){this.options.skin=this.options.skin?this.options.skin:ui.defaultSkin;UI.skin=new UI.Skin(this.options.skin);this.skin=UI.skin.get(this);this.props=this.skin[this.options.state]},setState:function(b,a){if(this.skin[b]){this.state=b;if(this.skin[b].styles){this.setStyles(this.skin[b].styles)}this.fireEvent("render",b)}return this},setCanvas:function(){if(this.paint||(this.props&&!this.props.layers)||(this.props&&this.props.layers&&$H(this.props.layers).getLength()<=2)||($defined(this.props.layers.def)&&!this.props.layers.def.length)){return false}if(this.element.getComputedSize()){var b=this.element.getComputedSize();this.computedSize=b}else{}var c=(b.computedLeft+b.computedRight);var a=(b.computedTop+b.computedBottom);this.paint=new UI.Paint({props:this.props,width:this.element.x+c,height:this.element.y+a,debug:this.options.debug,element:this.element,skin:this.options.skin,component:this.options.component,type:this.options.type,state:this.options.state}).inject(this.element).addEvent("click",function(){alert("click on canvas")});this.addEvent("render",function(e){var d;if(!e){d=this.props}else{d=this.skin[e]||this.props}this.paint.setSize(this.element.x+c,this.element.y+a,d)})},setSize:function(b,a,c,d){this.fireEvent("resize");this.element.x=b||this.options.width||this.props.width||this.element.getSize().x;this.element.y=a||this.options.height||this.props.height||this.element.getSize().y;if(this.element.x){this.element.setStyle("width",this.element.x)}if(this.element.y){this.element.setStyle("height",this.element.y)}this.fireEvent("render",c);return this},setLocation:function(c,b,a){this.element.left=c||this.options.left||this.props.defaultLeft||this.element.getCoordinates().x-this.props.shadowMagnify*2;this.element.top=b||this.options.top||this.props.defaultTop||this.element.getCoordinates().y-this.props.shadowMagnify*2;this.element[a?"morph":"setStyles"]({top:this.element.top,left:this.element.left});return this},setBehavior:function(){var a=this;if(this.options.draggable){this.enableDrag()}if(this.options.resizable){this.enableResize()}this.element.addEvents({mousedown:function(b){if(a.options.component!="label"){ui.controller.element.closeMenu(b)}a.fireEvent("mousedown")},click:function(){if(!Browser.Engine.trident){a.fireEvent("click")}},mouseup:function(){if(Browser.Engine.trident){a.fireEvent("click")}a.fireEvent("mouseup")},mouseenter:this.fireEvent.bind(this,"mouseenter"),mouseleave:this.fireEvent.bind(this,"mouseleave"),mouseover:this.fireEvent.bind(this,"mouseover"),mouseOut:this.fireEvent.bind(this,"mouseOut")})},enableDrag:function(){if(this.dragHandlers.length===0){this.dragHandlers=null}this.dragHandler=new Drag(this.element,{handle:this.dragHandlers,limit:{x:this.options.dragLimitX,y:this.options.dragLimitY},onStart:this.fireEvent.bind(this,"onDragStart"),onDrag:this.fireEvent.bind(this,"onDrag"),onComplete:this.fireEvent.bind(this,"onDragComplete")});this.addEvents({onDragComplete:this.adaptLocation.bind(this)});return this},disableDrag:function(){if(this.dragHandler){this.dragHandler.stop()}return this},enableResize:function(){var a=this;if(!this.options.resizeLimitX){this.options.resizeLimitX=10}if(!this.options.resizeLimitY){this.options.resizeLimitY=10}this.element.makeResizable({handle:this.resizer,limit:{x:a.options.resizeLimitX,y:a.options.resizeLimitY},onStart:function(){a.fireEvent("resizeStart")},onDrag:function(){a.fireEvent("resizeDrag")},onComplete:function(){a.fireEvent("resizeComplete")}.bind(this)});this.addEvents({resizeDrag:function(){this.setSize(this.element.getComputedSize().width,this.element.getComputedSize().height);this.fireEvent("redraw","button")},resizeComplete:function(){this.setSize(this.element.getComputedSize().width,this.element.getComputedSize().height)}});return this},getCenterLocation:function(){var a={};a.top=(window.getHeight()-this.options.height.toInt())/2;a.left=(window.getWidth()-this.options.width.toInt())/2;return a},adaptLocation:function(){var a={};var b=false;var c=this.element.getCoordinates();if(c.top.toInt()>window.getHeight()){a.top=window.getHeight()-$random(25,75);b=true}if(c.top.toInt()<0){a.top=50;b=true}if(c.left.toInt()+this.element.getStyle("width").toInt()<0){a.left=$random(25,75)-this.element.getStyle("width").toInt();b=true}if(this.element.getStyle("left").toInt()>window.getWidth()){a.left=window.getWidth()-$random(25,75);b=true}if(b){if(this.props.fx&&this.props.fx.adaptLocation){if(!this.reposFx){this.reposFx=new Fx.Morph(this.element,this.props.fx.adaptLocation)}this.reposFx.start(a)}}},show:function(){this.fireEvent("show");this.element.setStyle("opacity",1);this.element.show();return this},hide:function(){this.fireEvent("hide");this.element.hide();return this},setStyle:function(a,b){this.element.setStyle(a,b);return this},setStyles:function(a){this.element.setStyles(a);return this},getStyle:function(a){return this.element.getStyle(a)},inject:function(b,a){this.fireEvent("inject");this.element.inject(b,a);this.element.setStyle("visibility","visible");this.setSize("","","",b);this.setCanvas();ui.controller.element.register(this);this.fireEvent("injected");return this},adopt:function(a){this.element.adopt(a);this.setSize();return this},addClass:function(a){this.element.addClass(a);return this},set:function(c,b){if(c=="html"&&this.label){this.label.set(c,b);this.setSize()}else{if(c=="morph"){var a=this;this.element.set(c,b);this.element.get("morph").addEvents({onMorph:function(){var d=this.element.getSize();a.setSize(d.x,d.y)}})}else{this.element.set(c,b)}}return this},get:function(a){return this.element.get(a)},getSize:function(){return this.element.getSize()},morph:function(a){return this.element.morph(a)},getComputedSize:function(){return this.element.getComputedSize()},getCoordinates:function(a){return this.element.getCoordinates(a)},destroy:function(){this.element.destroy();return}});Element.implement({disableSelect:function(){if(typeof this.onselectstart!="undefined"){this.onselectstart=function(){return false}}else{if(typeof this.style.MozUserSelect!="undefined"){this.style.MozUserSelect="none"}else{this.onmousedown=function(){return false}}}this.style.cursor="default";return this},enableSelect:function(){if(this.onselectstart){this.onselectstart=""}else{if($type(this.style.MozUserSelect)=="none"){this.style.MozUserSelect=""}else{this.onmousedown=function(){return true}}}this.style.cursor="default";return this}});ui.controller.element={start:function(){this.list=[];this.zIndex=1;this.groups={};this.elements=[];this.closeMenu=$empty;this.setBehavior();this.handelKeys()},register:function(a){var b=this.list.push(a)-1;if(a.element.getStyle("zIndex")=="auto"||a.element.getStyle("zIndex")===0){a.element.setStyle("zIndex",a.options.zIndex||this.zIndex++)}if(a.options.group){this.group(b)}},group:function(a){this.groups[this.list[a].options.group]=this.groups[this.list[a].options.group]||[];this.groups[this.list[a].options.group].push(a)},serialize:function(b){if(!this.groups[b]){return false}var a=[];this.groups[b].each(function(c){if(c.value){a.push(c.options.name+"="+c.value)}});return a.join("&")},setBehavior:function(){document.addEvent("mousedown",function(a){this.closeMenu(a)}.bind(this))},handelKeys:function(){window.addEvent("keydown",function(a){if(a.key=="down"&&this.menu){this.menu.goDown()}else{if(a.key=="up"&&this.menu){this.menu.goUp()}}}.bind(this))}};ui.controller.element.start();UI.Box=new Class({Extends:UI.Element,options:{component:"box",title:"box"},build:function(a){this.parent(a)}});UI.Bubble=new Class({Extends:UI.Element,options:{component:"bubble",label:"Bubble",target:"element",resetPosition:true,zIndex:1000},initialize:function(a){this.parent(a);this.inject($(document.body));this.setLocation();this.fade(1)},build:function(){this.parent();this.control=this.element;if(this.options.label){this.label=new UI.Label({html:this.options.label,styles:this.props.components.label.styles,image:this.options.image,onImageLoad:function(){this.setSize();this.setLocation()}.bind(this)}).inject(this.element)}this.fx=new Fx.Tween(this.element,{wait:false,onStart:function(){this.element.show()},onComplete:function(){if(!this.element.getStyle("opacity")){this.element.hide()}}})},setBehavior:function(){this.parent();this.element.addEvents({click:function(){this.fade(0)}.bind(this)})},setLocation:function(){var a=this.getLocation();this.element.setStyles({left:a.left,top:a.top});if(this.options.resetPosition){this.posFx=new Fx.Morph(this.element,{wait:false});this.reposition=function(){var b=this.getLocation();this.posFx.start({left:b.left,top:b.top})}.bind(this);window.addEvents({resize:this.reposition,setTipsPosition:this.reposition})}},getLocation:function(){var a=this.element.getCoordinates();var d=this.options.target.getCoordinates();var c,b;if(this.options.type=="bottom"){c=d.right-40;b=d.top+d.height+10}else{c=d.right-40;b=d.top-a.height-10}return{top:b,left:c}},setSize:function(b,a){if(this.label){b=b||this.options.width||this.props.width||this.label.getSize().x;a=a||this.options.height||this.props.height||this.label.getSize().y}this.parent(b,a)},fade:function(a){this.fx.start("opacity",a);return this},destroy:function(){window.removeEvent("resize",this.reposition);this.parent()}});UI.Label=new Class({Extends:UI.Element,options:{component:"label",tag:"span",html:"Label",emboss:false,selectable:false},build:function(){this.parent();if(this.options.image){this.buildImage()}},buildImage:function(){this.image=new Element("img",$merge(this.props.components.image,{src:this.options.image,events:{load:this.fireEvent.bind(this,"onImageLoad")}})).inject(this.element,"top")}});UI.ProgressBar=new Class({Extends:UI.Element,options:{component:"progressbar",tag:"div",width:200,height:18,speed:2000,fx:Fx.Transitions.Quad.easeOut},build:function(){this.parent();this.progress=new UI.Element({component:"progressbar",height:this.options.height,width:1,type:this.options.type,state:"progress"}).inject(this.element)},reach:function(a){this.progress.show();var d=0;if(a==0){d=1;a=1}var b=this.element.getSize().x*a/100;var c=this;this.progress.set("morph",{duration:this.options.speed,transition:this.options.fx,onComplete:function(){if(d){c.fireEvent("render");c.progress.hide()}else{c.progress.setSize(b.toInt(),this.options.height);c.fireEvent("render")}}}).morph({width:b.toInt()});return this}});UI.Scrollbar=new Class({Extends:UI.Element,options:{component:"scrollbar",type:"track",direction:"vertical",maxThumbSize:32,wheel:16},initialize:function(a){this.parent(a);this.bound={start:this.start.bind(this),end:this.end.bind(this),drag:this.drag.bind(this),wheel:this.wheel.bind(this),page:this.page.bind(this)};this.container=this.options.container;this.position={};this.mouse={};this.update();this.attach()},build:function(){if(this.options.direction=="vertical"){if(!this.options.size){this.options.width=this.props.size}}else{if(!this.options.size){this.options.height=this.props.size}}this.parent();this.inject(this.options.container,"before");this.thumb=new UI.Element({skin:this.options.skin,component:this.options.component,type:"thumb"}).inject(this.element)},update:function(){if(this.options.direction=="vertical"){this.containerSize=this.options.container.getComputedSize().totalHeight;this.setSize(this.options.width.toInt(),this.containerSize);this.containerScrollSize=this.options.container.scrollHeight;this.trackSize=this.element.offsetHeight.toInt()}else{this.containerSize=this.options.container.getComputedSize().totalWidth;this.setSize(this.containerSize,this.options.height.toInt());this.containerScrollSize=this.options.container.scrollWidth;this.trackSize=this.element.offsetWidth.toInt()}if(this.containerScrollSize===0){return}if(this.isVisible()){this.thumb.element.setStyle("visibility","visible")}else{this.thumb.element.setStyle("visibility","hidden")}this.containerRatio=this.containerSize/this.containerScrollSize;this.thumbSize=this.trackSize*this.containerRatio;var a;if(this.thumbSize<this.options.maxThumbSize.toInt()){this.thumbSize=this.options.maxThumbSize.toInt();a=this.trackSize-this.thumbSize}else{if(this.thumbSize>this.trackSize){this.thumbSize=this.options.maxThumbSize.toInt()}else{a=this.trackSize}}this.scrollRatio=this.containerScrollSize/a;if(this.options.direction=="vertical"){this.thumb.setSize(this.options.width,this.thumbSize)}else{this.thumb.setSize(this.thumbSize,this.options.height)}this.updateThumbFromContentScroll();this.updateContentFromThumbPosition()},updateContentFromThumbPosition:function(){if(this.options.direction=="vertical"){this.options.container.scrollTop=this.position.now*this.scrollRatio}else{this.options.container.scrollLeft=this.position.now*this.scrollRatio}},updateThumbFromContentScroll:function(){if(this.options.direction=="vertical"){this.position.now=(this.options.container.scrollTop/this.scrollRatio).limit(0,(this.trackSize));this.thumb.setStyle("top",this.position.now+"px")}else{this.position.now=(this.options.container.scrollLeft/this.scrollRatio).limit((this.trackSize),0);this.thumb.setStyle(this.position.now+"px","left")}},attach:function(){this.thumb.element.addEvent("mousedown",this.bound.start);if(this.options.wheel){this.options.container.addEvent("mousewheel",this.bound.wheel)}this.element.addEvent("mouseup",this.bound.page)},wheel:function(a){if(this.options.direction=="vertical"){this.options.container.scrollTop-=a.wheel*this.options.wheel}else{this.options.container.scrollLeft-=a.wheel*this.options.wheel}this.updateThumbFromContentScroll();a.stop()},page:function(a){if(this.options.direction=="vertical"){if(a.page.y>this.thumb.element.getPosition().y){this.options.container.scrollTop+=this.options.container.offsetHeight}else{this.options.container.scrollTop-=this.options.container.offsetHeight}}else{if(a.page.x>this.thumb.element.getPosition().x){this.options.container.scrollLeft+=this.options.container.offsetWidth}else{this.options.container.scrollLeft-=this.options.container.offsetWidth}}this.updateThumbFromContentScroll();a.stop()},start:function(a){if(this.options.direction=="vertical"){this.mouse.start=a.page.y;this.position.start=this.thumb.element.getStyle("top").toInt()}else{this.mouse.start=a.page.x;this.position.start=this.thumb.element.getStyle("left").toInt()}document.addEvent("mousemove",this.bound.drag);document.addEvent("mouseup",this.bound.end);this.thumb.element.addEvent("mouseup",this.bound.end);a.stop()},end:function(a){document.removeEvent("mousemove",this.bound.drag);document.removeEvent("mouseup",this.bound.end);this.thumb.element.removeEvent("mouseup",this.bound.end);a.stop()},drag:function(a){if(this.options.direction=="vertical"){this.mouse.now=a.page.y}else{this.mouse.now=a.page.x}this.position.now=(this.position.start+(this.mouse.now-this.mouse.start)).limit(0,(this.trackSize-this.thumbSize));this.updateContentFromThumbPosition();this.updateThumbFromContentScroll();a.stop()},isVisible:function(){if(this.containerSize<this.containerScrollSize){return true}else{return false}}});UI.Control=new Class({Extends:UI.Element,options:{},build:function(){this.parent();this.control=this.element},setSize:function(c,a,d){var b,e;if(this.label){b=c||this.options.width||this.props.width||this.label.getSize().x;e=a||this.options.height||this.props.height||this.label.getSize().y}else{if(this.input&&this.input.getProperty("type")!="hidden"){b=c||this.options.width||this.props.width||this.input.getSize().x;e=a||this.options.height||this.props.height||this.input.getSize().y}}this.parent(b,e,d)},setInput:function(b,a){if(!$defined(a)){a="input"}if(!$defined(b)){b="hidden"}if(b){this.input=new Element(a,{type:b,name:this.options.name}).inject(this.control)}else{this.input=new Element(a,{name:this.options.name}).inject(this.control)}switch(a){case"input":this.input.set("value",this.options.value);break;case"textarea":this.input.set("html",this.options.value);break}if(b!="hidden"){this.input.set(this.props.components.input)}},getForm:function(){if(this.control){var a=this.control.getParent();while(a.get("tag")!="form"){a=a.getParent()}return a}return false},setBehavior:function(){this.parent();if(this.input){this.input.addEvents({blur:this.fireEvent.bind(this,"blur"),focus:this.fireEvent.bind(this,"focus")})}},set:function(b,a){if(b=="html"){if(this.label){this.label.set(b,a)}this.setSize()}else{this.element.set(b,a)}}});UI.Input=new Class({Extends:UI.Control,options:{component:"input",name:"ui-input",value:""},build:function(){this.parent();this.setInput("text");this.input.setStyle("width",this.props.width-this.input.getStyle("paddingLeft").toInt()-this.input.getStyle("paddingRight").toInt())},setState:function(a){this.parent(a);if(this.skin[a]){this.input.set(this.skin[a].components.input.styles)}},setBehavior:function(){this.parent();this.addEvents({blur:this.setState.bind(this,"default"),focus:this.setState.bind(this,"focus")})}});UI.Button=new Class({Extends:UI.Control,options:{component:"button",label:"Button",submit:false},build:function(){this.parent();if(this.options.label){this.label=new UI.Label({skin:this.options.skin,html:this.options.label,styles:this.props.components.label.styles,image:this.options.image,onImageLoad:function(){this.setSize()}.bind(this)}).inject(this.element)}},setState:function(a){if(this.label&&this.skin[a]){this.label.setStyles(this.skin[a].components.label.styles)}this.parent(a)},setBehavior:function(){this.parent();this.element.addEvents({mouseenter:this.setState.bind(this,"over"),mousedown:function(a){this.setState("down");new Event(a).stop()}.bind(this),mouseleave:function(){this.setState(this.options.state)}.bind(this),mouseup:function(){if(this.options.submit){this.submit()}this.setState("over")}.bind(this)})},submit:function(){this.getForm().submit()}});UI.Textarea=new Class({Extends:UI.Control,options:{component:"textarea",name:"ui-input",value:""},build:function(){this.parent();this.setInput(false,"textarea");this.input.set({styles:{width:this.props.width-this.input.getStyle("paddingLeft").toInt()-this.input.getStyle("paddingRight").toInt(),height:this.props.height-this.input.getStyle("paddingTop").toInt()-this.input.getStyle("paddingBottom").toInt(),overflow:"hidden",margin:0}})},setBehavior:function(){this.parent();this.addEvents({blur:this.setState.bind(this,"default"),focus:this.setState.bind(this,"focus")})}});UI.Checkbox=new Class({Extends:UI.Control,options:{label:false,name:"checkbox-input",value:"default",checked:false,component:"checkbox"},build:function(){this.parent();this.setInput();if(this.options.label){this.label=new UI.Label({"for":this.options.name,skin:this.options.skin,html:this.options.label,styles:this.props.labelStyles}).inject(this.element);delete this.props.width;delete this.props.height}this.control.store("value",this.options.value);if(this.options.checked){this.toggleValue()}},toggleValue:function(){if(this.state=="checked"){this.setState("default");this.state="default";this.input.value="";this.value=undefined}else{this.setState("checked");this.state="checked";this.input.value=this.control.retrieve("value");this.value=this.control.retrieve("value")}return this},setBehavior:function(){this.parent();this.element.addEvents({click:function(b){var a=new Event(b).stop();this.toggleValue()}.bind(this)})}});UI.RadiosGroup=new Class({Extends:UI.Control,options:{name:"radiosgroup",component:"radio"},initialize:function(a){this.parent(a);this.radios=[];this.selectedRadio=false;return this},newRadio:function(c){var b=new Element("span",{"class":"ui-radio",styles:$merge({position:"relative",display:"inline-block",height:15,zIndex:this.radios.length+1},c.styles)}).store("value",c.value);this.radios.push(b);if(!this.radios[1]){this.control=b;this.setInput()}if(c.label){var a=new UI.Label({skin:this.options.skin,"for":this.options.name,html:c.label,styles:this.props.styles}).inject(b);b.setStyle("width",100)}else{b.setStyle("width",this.props.width)}this.setCanvas(b);if(c.selected&&!this.selectedRadio){this.selectedRadio=b;this.input.value=b.retrieve("value");this.setState(b,"selected")}this.addRadioAction(b);return b},addRadioAction:function(a){a.addEvents({click:function(){if(this.selectedRadio){this.setState(this.selectedRadio,"default")}this.setState(a,"selected");this.selectedRadio=a;this.input.value=a.retrieve("value")}.bind(this)})},setCanvas:function(a){if(a.canvas||(this.props&&!this.props.layers)||(this.props&&this.props.layers&&this.props.layers.length===0)){return false}a.paint=new UI.Paint({props:this.props,width:this.props.width,height:this.props.height}).inject(a);a.addEvent("drawCanvas",function(){this.paint.setSize(this.element.x,this.element.y,this.props)})},setState:function(a,b){a.paint.draw(this.skin[b])}});UI.Select=new Class({Extends:UI.Control,options:{component:"select",scrollToSelected:true,list:{}},build:function(){this.parent();this.setInput();this.addMenuActions(this.options.list);this.menu=new UI.Menu({width:this.options.width,skin:this.options.skin,position:"over",target:this.element,menu:this.options.list,scrollToSelected:this.options.scrollToSelected}).inject(document.body);var a=this.menu.content.getFirst().getSize().x;a-=this.menu.content.getFirst().getStyle("paddingRight").toInt();a-=this.menu.content.getFirst().getStyle("paddingLeft").toInt();this.menu.setStyle("display","none");this.label=new UI.Label({width:a,skin:this.options.skin,styles:this.props.components.label.styles,html:this.options.list[0].text}).inject(this.element)},setBehavior:function(){this.parent();this.element.addEvents({mousedown:function(b){ui.controller.element.closeMenu();this.menu.show(this.element);var a=new Event(b).stop()}.bind(this)})},addMenuActions:function(a){a.each(function(b){if(!b.menu&&b.text!="separator"){b.action=function(){this.input.value=(b.value)?b.value:b.text;this.label.set("html",b.text)}.bind(this)}else{if(b.menu){this.addMenuActions(b.menu)}}},this)}});UI.Slider=new Class({Extends:UI.Element,options:{component:"slider",type:"horizontal",onStart:$empty,onChange:$empty,onComplete:$empty,onTick:$empty,snap:false,offset:0,range:false,wheel:false,steps:100},initialize:function(a){this.parent(a)},build:function(){this.parent();this.handler=new UI.Element({skin:this.options.skin,component:"slider",type:"knob"}).inject(this.element)},inject:function(c,a){this.fireEvent("inject");var b=this;this.element.inject(c,a);this.element.setStyle("visibility","visible");this.setSize();this.setCanvas();ui.controller.element.register(this);this.slider=new Slider(this.paint.canvas,this.handler.element,{snap:this.options.snap,offset:this.options.offset,range:this.options.range,wheel:this.options.wheel,steps:this.options.steps,mode:this.options.type,onStart:function(d){b.fireEvent("start",d)},onTick:function(d){if(this.options.snap){d=this.toPosition(this.step)}this.knob.setStyle(this.property,d)},onChange:function(d){b.fireEvent("change",d)},onComplete:function(d){b.fireEvent("complete",d)}});this.fireEvent("injected");return this},setBehavior:function(){this.parent();this.addEvent("complete",function(a){this.value=a})},set:function(a){return this.slider.set(a)}});UI.Menu=new Class({Extends:UI.Element,options:{component:"menu",rolloverType:"menuRollover",zIndex:3000,contentTag:"div",itemTag:"div",position:"normal",scrollToSelected:false,scrollMargin:20,menu:[]},build:function(a){this.parent();this.content=new Element(this.options.contentTag,{styles:{zIndex:2,position:"relative",padding:this.props.components.wrapper.styles.padding,margin:0,listStyle:"none"}}).inject(this.element);this.buildMenu();this.element.setStyles({zIndex:this.options.zIndex})},buildMenu:function(c){this.empty();var b=(c)?c:this.options.menu;var a;this.items=[];this.currentIndex=0;b.each(function(d){if(d.text=="separator"){a=new UI.Label({skin:this.options.skin,tag:this.options.itemTag,html:"",styles:this.props.components.separator.styles}).inject(this.content);a.separator=true}else{a=new UI.Label({skin:this.options.skin,tag:this.options.itemTag,html:d.text,props:UI.skin.getComponentProps(this.skin,"menuItem"),image:d.image}).set(d.options);this.items.push(a);if(d.action){a.element.addEvent("action",d.action)}a.inject(this.content)}this.addSubmenuEvents(d,a)},this);return this},setBehavior:function(){this.parent();if(!this.options.closeMenu){this.addEvent("onCloseMenu",function(a){ui.controller.element.closeMenu=$empty;this.hide(300)}.bind(this))}else{this.addEvent("onCloseMenu",function(){this.options.closeMenu()}.bind(this))}},addSubmenuEvents:function(c,b){var a=this;if(c.menu){b.addEvents({mouseenter:function(){if(a.activeItem&&a.activeItem.submenu&&a.activeItem!=b){a.activeItem.submenu.hide()}if(a.activeItem!=b){a.addSubmenu(c,b,"normal")}a.moveRollover(b)}});a.addSubmenuArrow(b)}else{b.addEvents({mouseenter:function(){a.removeSubmenu();if(b.separator){a.removeRollover()}else{a.moveRollover(b)}}})}b.element.addEvents({mouseleave:function(){$clear(a.menuActionDelay)},mouseup:function(){a.mouseUpAction(b)},mousedown:function(f){var d=new Event(f).stop();if(!b.separator){a.fireEvent("change")}}})},addSubmenu:function(c,b,a){this.menuWithAction=false;$clear(this.menuActionDelay);this.menuActionDelay=(function(){if(!b.submenu){b.submenu=new UI.Menu({skin:this.options.skin,target:b,menu:c.menu,closeMenu:this.fireEvent.bind(this,"closeMenu"),openOnRollover:this.options.openOnRollover,closeOnRollout:this.options.closeOnRollout,position:a,zIndex:this.options.component=="toolbar"?--this.options.zIndex:++this.options.zIndex}).inject(document.body);ui.controller.element.closeMenu=this.fireEvent.bind(this,"closeMenu")}else{b.submenu.show(b)}}.bind(this)).delay(this.props.showDelay)},addSubmenuArrow:function(a){this.addEvent("addArrows",function(){a.arrow=new UI.Element({skin:this.options.skin,component:"element",type:"menuRightArrow",styles:{height:"10",width:"20",padding:0,position:"absolute",right:8,display:"block"}}).inject(a,"top");a.arrow.setStyle("top",(a.element.getHeight()-a.arrow.element.getHeight())/2);a.element.addEvents({mouseenter:function(){a.arrow.setState("over")},defaultArrow:function(){a.arrow.setState("default")}})})},mouseUpAction:function(a){if($time()-this.time>300&&this.rollover){var b=new Fx.Tween(this.rollover.element,{duration:100,onComplete:function(){if(this.selected){this.selected.selected=false}this.selected=a.element;a.element.selected=true;this.fireEvent("closeMenu");a.element.fireEvent("action")}.bind(this)}).start("opacity",0,1)}},setRollover:function(){if(this.rollover){return}this.rollover=new UI.Element({skin:this.options.skin,type:this.options.rolloverType,styles:{position:"absolute",zIndex:1}}).inject(this.element)},moveRollover:function(a){var b=a.getCoordinates(this.element);this.setRollover();if(this.activeItem){this.activeItem.element.fireEvent("defaultArrow");this.activeItem.setState("default")}this.rollover.setSize(b.width,b.height).setStyles({display:"block",top:b.top,left:b.left});a.setState("over");this.activeItem=a},removeRollover:function(){if(this.rollover){this.rollover.destroy();delete this.rollover;this.activeItem.element.fireEvent("defaultArrow");this.activeItem.setState("default")}this.activeItem=false},removeSubmenu:function(){if(this.activeItem&&this.activeItem.submenu){this.activeItem.element.fireEvent("defaultArrow");this.activeItem.submenu.hide(this.props.hideFxDuration)}},setPosition:function(e){var d=e.getCoordinates();var b=this.element.getCoordinates();this.element.setStyle("height",b.height);var g,f;if(this.options.position=="bottom"){this.setCorners([0,0,4,4]);this.element.setStyles({left:d.left,top:d.bottom});b=this.element.getCoordinates();if(b.bottom+this.options.scrollMargin>(Window.getHeight())||b.top<this.options.scrollMargin){this.addScrolls()}}else{if(this.options.position=="over"){this.setCorners([4,4,4,4]);var c=false;if(this.options.scrollToSelected){this.content.getElements(this.options.itemTag).each(function(i){if(i.selected){c=i}})}f=(!c)?d.top-this.content.getStyle("paddingTop").toInt():d.top-c.getCoordinates(this.element).top;this.element.setStyles({top:f+1,left:d.left-1});var h=Window.getScroll();b=this.element.getCoordinates();b.top-=h.y;b.bottom-=h.y;if(b.bottom+this.options.scrollMargin>(Window.getHeight())||b.top<this.options.scrollMargin){this.addScrolls()}}else{var a=[4,4,4,4];if(b.width>(Window.getWidth()-d.right)){g=d.left-b.width+2;a[1]=0}else{g=d.right-2;a[0]=0}if(b.height<(Window.getHeight()-d.top+Window.getScroll().y)){f=d.top-this.content.getStyle("paddingTop").toInt()}else{if(b.height<(d.top-Window.getScroll().y)){f=d.bottom-b.height+this.content.getStyle("paddingTop").toInt();a=[4,4,a[1],a[0]]}else{a=[4,4,4,4];f=d.top-this.content.getStyle("paddingTop").toInt();this.element.setStyles({top:f,left:g});this.addScrolls()}}this.setCorners(a);this.element.setStyles({top:f,left:g})}}},setCorners:function(a){this.props.layers["default"].radius=a},addScrolls:function(){this.scrolls=new UI.MenuScroller({skin:this.options.skin,element:this.element,content:this.content,margin:this.options.scrollMargin,props:this.props,onScroll:function(){this.removeSubmenu();this.removeRollover()}.bind(this),onResize:function(){var a=this.element.getSize();this.setSize(a.x,a.y)}.bind(this)});this.addEvent("removeScrolls",function(){this.scrolls.removeScrolls();this.removeEvents("removeScrolls")}.bind(this))},goDown:function(){this.moveRollover(this.items[++this.currentIndex])},goUp:function(){this.moveRollover(this.items[--this.currentIndex])},inject:function(a,b){this.time=$time();this.fireEvent("inject");this.element.inject(a,b);this.setSize();if(this.options.position!="over"){if(this.options.target){this.setPosition(this.options.target)}else{this.setPosition(a)}this.setCanvas();this.setStyle("visibility","visible")}else{this.setCanvas()}this.fireEvent("addArrows");if(this.options.closeOnRollout){this.paint.canvas.addEvent("mouseleave",function(){this.fireEvent("closeMenu")}.bind(this))}return this},show:function(b,a,c){ui.controller.element.closeMenu=this.fireEvent.bind(this,"closeMenu");ui.controller.element.menu=this;this.time=$time();this.element.setStyle("display","block");this.setPosition(b);this.setSize(a,c);this.parent();return this},hide:function(b){if(!$defined(b)){b=this.props.hideFxDuration}ui.controller.element.menu=false;this.fireEvent("hide");this.removeSubmenu();if(!b){this.setStyle("display","none");this.removeRollover();this.fireEvent("removeScrolls")}else{var a=new Fx.Tween(this.element,{duration:b,onComplete:function(){this.setStyle("display","none");this.removeRollover();this.fireEvent("removeScrolls")}.bind(this)}).start("opacity",0)}return this},empty:function(){this.content.empty();return this}});UI.Toolbar=new Class({Extends:UI.Menu,options:{tag:"div",menus:[],zIndex:4000,openOnRollover:false,closeOnRollout:false,rolloverType:"toolbarRollover",component:"toolbar"},initialize:function(a){this.parent(a)},build:function(){this.addItemStyles();this.parent();this.element.setStyles({position:"relative",width:"100%",overflow:"hidden"})},setBehavior:function(){this.addEvent("onCloseMenu",function(){this.removeSubmenu();(function(){this.removeRollover()}.bind(this)).delay(this.props.hideFxDuration);ui.controller.element.closeMenu=$empty}.bind(this))},inject:function(a,b){this.fireEvent("inject");this.setStyle("visibility","visible");this.element.inject(a,b);this.setSize($(a).getWidth(),false);this.setCanvas();ui.controller.element.register(this);this.fireEvent("injected");window.addEvent("resize",function(){this.setSize(this.element.getParent().getSize().x)}.bind(this));return this},addItemStyles:function(){this.options.menu.each(function(a){a.options=a.options||{};a.options.styles={"float":"left",color:this.props.fontColor}},this)},addSubmenuEvents:function(b,a){if(b.menu){a.element.addEvents({mousedown:function(d){ui.controller.element.closeMenu(d);if(this.activeItem!=a){this.time=$time();if(!b.action){this.addSubmenu(b,a,"bottom");this.moveRollover(a)}else{this.menuWithAction=(function(){if(this.activeItem&&this.activeItem.submenu){this.activeItem.submenu.hide(0)}this.moveRollover(a);this.addSubmenu(b,a,"bottom");this.menuWithAction=false}).delay(this.props.actionDelay,this)}}var c=new Event(d).stop()}.bind(this),mouseup:function(){if($time()-this.time>800){this.fireEvent("closeMenu")}}.bind(this),mouseenter:function(){if(this.activeItem&&this.activeItem!=a&&!b.action){if(this.activeItem.submenu){this.activeItem.submenu.hide(0)}this.addSubmenu(b,a,"bottom");this.moveRollover(a)}else{if(this.options.openOnRollover){a.element.fireEvent("mousedown")}}}.bind(this),hideSubmenu:function(){if(!a.submenu){return}this.hideFx=new Fx.Tween(a.submenu.element,{duration:this.props.hideFxDuration,onComplete:function(){this.removeRollover();this.fireEvent("closeMenu");this.removeSubmenu()}.bind(this)}).start("opacity",0)}.bind(this)})}a.element.addEvents({mousedown:function(d){if(!b.menu&&this.activeItem){this.activeItem.fireEvent("hideSubmenu")}a.down=true;var c=new Event(d).stop()}.bind(this),mouseleave:function(){a.down=false},mouseup:function(){if(this.menuWithAction||!b.menu){this.removeSubmenu()}if(this.menuWithAction){$clear(this.menuWithAction);delete this.menuWithAction}if(a.down&&(!a.submenu||(a.submenu&&a.submenu.element.getStyle("visibility")=="hidden"))){a.element.fireEvent("action")}a.down=false}.bind(this)})}});UI.Context=new Class({Extends:UI.Menu,options:{className:"ui-menu-context",contexts:[],scope:$(document.body),container:$(document.body),trigger:"contextmenu",type:"context"},initialize:function(a){this.parent(a);if(!this.options.container){this.options.container=$(document.body)}this.addContexts(this.options.contexts,this.options.container);this.element.hide();this.element.inject(this.options.container)},addContexts:function(b,a){b.each(function(c){a.getElements(c.target).each(function(d){d.addEvent(this.options.trigger,function(f){new Event(f).stop();this.hide(0);this.buildMenu(c.menu);this.show(f)}.bind(this));this.element.addEvent("contextmenu",function(f){new Event(f).stop()})},this)},this);return this},removeContexts:function(a){document.body.getElements(a).each(function(b){b.removeEvents("contextmenu")},this);return this},setPosition:function(a,e){if(!$defined(a)||!$defined(e)){return}var d=this.element.getCoordinates();var c=e+this.options.container.getScrollTop();var b=a+this.options.container.getScrollLeft();if((a+d.width+20)>this.options.container.getWidth()){b=b-d.width}if((e+d.height+20)>this.options.container.getHeight()){c=c-d.height}this.element.setStyles({top:c,left:b})},show:function(a){this.parent();ui.controller.element.closeMenu=function(c){if(c.rightClick||this.options.event!="contextmenu"){ui.controller.element.closeMenu=$empty;this.hide(0)}else{ui.controller.element.closeMenu=$empty;this.hide(300)}}.bind(this);var b=this.content.getCoordinates();this.setSize(b.width,b.height);this.setPosition(a.client.x,a.client.y);this.setCanvas()}});UI.MenuScroller=new Class({Implements:[Events,Options],options:{className:"ui-scrollbar",wheel:8,speed:12,margin:20,target:"element",onScroll:$empty,onResize:$empty},initialize:function(a){this.setOptions(a);this.element=this.options.element;this.content=this.options.content;this.margin=this.options.margin;this.resetSize();this.setWrapper();this.setBehavior()},resetSize:function(){var d=Window.getScroll();var b=this.element.getCoordinates();b.top-=d.y;b.bottom-=d.y;var a=[0,0];this.element.setStyle("display","none");var c=Window.getHeight();if(b.top<=this.margin&&b.bottom>c-this.margin){this.content.setStyles({top:b.top-this.margin});this.element.setStyles({top:this.margin,height:c-this.margin*2});a=[1,1]}else{if(b.bottom>c-this.margin){this.element.setStyles({height:c-b.top-this.margin});a[1]=1}else{if(b.top<=this.margin){this.content.setStyles({top:b.top-this.margin});this.element.setStyles({top:this.margin+d.y,height:b.bottom-this.margin});a[0]=1}}}this.element.setStyle("display","block");if(a[0]){this.addUpArrow()}if(a[1]){this.addDownArrow()}},setWrapper:function(){var a=this.element.getCoordinates();this.paddingTop=this.content.getStyle("paddingTop").toInt();this.paddingBottom=this.content.getStyle("paddingBottom").toInt();this.paddingTB=this.paddingTop+this.paddingBottom;this.wrapper=new Element("div",{"class":"menu-overflow-wrapper",styles:{overflow:"hidden",position:"relative",width:a.width,height:a.height-this.paddingTB,marginTop:this.paddingTop,marginBottom:this.paddingBottom,zIndex:2}}).inject(this.element,"top").grab(this.content);this.content.setStyles({paddingTop:0,paddingBottom:0})},setBehavior:function(){this.element.addEvent("mousewheel",function(b){var a=new Event(b).stop();if(b.wheel>0){this.scrollUp(b.wheel)}else{this.scrollDown(b.wheel)}}.bind(this))},removeScrolls:function(){this.content.setStyles({top:0,paddingTop:this.paddingTop,paddingBottom:this.paddingBottom});this.element.setStyles({height:"auto",top:"auto"}).grab(this.content).removeEvents("mousewheel");this.wrapper.destroy();this.fireEvent("destroyArrows")},addUpArrow:function(){var c=Window.getScroll();var a=this.element.getCoordinates();a.top-=c.y;a.bottom-=c.y;this.arrowUp=new Element("div",{"class":"ui-menu-arrow-up"}).setStyles({position:"absolute",width:a.width,height:a.top+20,top:-a.top,left:0,zIndex:2}).inject(this.element,"bottom");this.arrowUp.canvas=new UI.Element({width:a.width,height:20,skin:this.options.skin,type:"menuArrow",state:"up"}).setStyles({position:"absolute",bottom:0,zIndex:-1}).inject(this.arrowUp);var b=this;this.arrowUp.addEvents({mouseover:function(){b.scroller=b.scrollUp.periodical(30,b,2)},mouseout:function(){$clear(b.scroller)}});this.addEvent("destroyArrows",function(){if(this.arrowUp){this.arrowUp.destroy();this.arrowUp=false}})},addDownArrow:function(){var b=Window.getScroll();var a=this.element.getCoordinates();a.top-=b.y;a.bottom-=b.y;this.arrowDown=new Element("div",{"class":"ui-menu-arrow-down"}).setStyles({position:"absolute",width:a.width,height:window.getHeight()-a.bottom+20,bottom:a.bottom-window.getHeight(),left:0,zIndex:2}).inject(this.element,"bottom");this.arrowDown.canvas=new UI.Element({width:a.width,height:20,skin:this.options.skin,type:"menuArrow",state:"down"}).setStyles({position:"absolute",top:0,zIndex:-1}).inject(this.arrowDown);this.arrowDown.addEvents({mouseover:function(){this.scroller=this.scrollDown.periodical(30,this,-2)}.bind(this),mouseout:function(){$clear(this.scroller)}.bind(this)});this.addEvent("destroyArrows",function(){if(this.arrowDown){this.arrowDown.destroy();this.arrowDown=false}})},scrollDown:function(c){this.fireEvent("scroll");var b=this.element.getCoordinates();var d=this.wrapper.getCoordinates();var a=this.content.getCoordinates();if(a.bottom>d.bottom){if(b.top-Window.getScroll().y-this.options.speed>this.margin){this.element.setStyles({top:this.element.getStyle("top").toInt()-this.options.speed,height:b.height+this.options.speed});this.wrapper.setStyle("height",d.height+this.options.speed);this.fireEvent("resize")}else{if(!this.arrowUp){this.addUpArrow()}this.content.setStyle("top",this.content.getStyle("top").toInt()-this.options.speed*(-c))}}else{if(this.arrowDown){if(!this.arrowUp){this.wrapper.setStyle("height",a.height+this.paddingTB);this.element.setStyle("height",a.height+this.paddingTB);this.element.setStyle("top",this.element.getStyle("top").toInt()+this.paddingTB);this.fireEvent("resize")}else{this.content.setStyle("top",b.height-a.height-this.paddingTB)}$clear(this.scroller);this.arrowDown.destroy();this.arrowDown=false}}},scrollUp:function(c){this.fireEvent("scroll");var b=this.element.getCoordinates();var d=this.wrapper.getCoordinates();var a=this.content.getCoordinates();if(a.top<d.top){if(b.bottom+this.margin<Window.getHeight()+Window.getScroll().y){this.element.setStyle("height",b.height+this.options.speed);this.wrapper.setStyle("height",d.height+this.options.speed);this.content.setStyle("top",this.content.getStyle("top").toInt()+this.options.speed);this.fireEvent("resize")}else{if(!this.arrowDown){this.addDownArrow()}this.content.setStyle("top",this.content.getStyle("top").toInt()+this.options.speed*c)}}else{if(this.arrowUp){this.content.setStyle("top",0);if(!this.arrowDown){this.wrapper.setStyle("height",a.height+this.paddingTB);this.element.setStyle("height",a.height+this.paddingTB);this.fireEvent("resize")}$clear(this.scroller);this.arrowUp.destroy();this.arrowUp=false}}}});UI.View=new Class({Extends:UI.Element,options:{component:"view",width:"100%",height:"100%",overflow:"scrollbar",tag:"span",contentTag:"div",content:{},useOverlay:true,scrollbar:{}},build:function(){this.parent();this._setOverflow();this.show()},buildOverlay:function(){this.overlay=new Element("div",this.props.components.overlay).inject(this.element);this.addEvents({onLoadComplete:function(){this.overlay.hide()}})},_setOverflow:function(){if(this.options.overflow!="hidden"){this.content=new Element(this.options.contentTag,this.options.content).setStyles({height:"100%",position:"relative",overflow:"hidden",margin:"0"}).inject(this.element);if(this.options.overflow=="hidden"){this.content.setStyle("overflow","hidden")}if(this.options.overflow=="scrollbar"){this.setScrollbar()}if(this.options.overflow=="scroller"){this.buildScrollbar()}this.content.addEvents({onInject:function(){this.updateSize()}.bind(this)})}else{this.content=this.element}},setScrollbar:function(){if(this.options.skin){this.options.scrollbar.skin=this.options.skin}this.options.scrollbar.container=this.content;this.scrollbar=new UI.Scrollbar(this.options.scrollbar);this.addEvents({loadCompplete:function(){this.scrollbar.update()},resize:function(){this.scrollbar.update()}})},setScroller:function(){this.scroller=new Scroller(this.content,this.options.scroller).addEvents({onChange:function(a,b){this.scrollbar.update()}.bind(this)});this.scroller.start()},setContent:function(b,a){switch(b){case"ajax"||"xhr":this.setAjaxContent(a);break;case"ajaxnu":this.setAjaxNuContent(a);break;case"json":this.setJsonContent(a);break;case"content"||"html":this.setHtmlContent(a);break;case"iframe":this.setIFrameContent(a);break}return this},setHtmlContent:function(a){this.content.set("html",a);this.fireEvent("loadComplete");this.fireEvent("resize");return this},setAjaxContent:function(b){if(this.iframe){this.iframe.destroy()}var a=new Request.HTML({url:b,update:this.content,method:"get",onComplete:function(){this.fireEvent("loadComplete");this.fireEvent("resize")}.bind(this)}).send();return this},setAjaxNuContent:function(c){var a=this;var b=new Request.HTML({url:c,method:"get",onComplete:function(g,d,h,f){var e=[h,g,d,f];a.fireEvent("onLoadComplete",e);a.fireEvent("resize")}}).send();return this},setJsonContent:function(b){var a=new Request.JSON({url:b,onComplete:function(c){this.fireEvent("loadComplete",new Array(c));this.fireEvent("resize")}.bind(this)}).get();return this},setIFrameContent:function(a){if(!this.iframe){if(this.content){this.content.destroy()}if(this.scrollbar){this.scrollbar.destroy()}this.iframe=new IFrame(this.props.components.iframe).setStyles({height:"100%",width:"100%",margin:0,padding:0,border:0}).setProperties({height:"100%",width:"100%"}).inject(this.element)}this.iframe.set("src",a).addEvent("load",function(){this.fireEvent("loadComplete");this.fireEvent("resize")}.bind(this));if(this.options.useOverlay){this.buildOverlay()}return this}});UI.ListView=new Class({Extends:UI.View,options:{component:"listview",data:[],itemObject:"Button",item:{component:"itemList",type:"default",label:false},scroller:false,width:"100%",height:"100%",itemType:"itemList"},build:function(){this.parent();this.getData(this.options.url);if(this.options.scroller){this.setScroller(this.options.scroller)}},getData:function(b,a){if(this.options.url){var c=new Request.JSON({url:b,onSuccess:function(d,e){this.addItems(d)}.bind(this)}).get()}else{this.addEvent("injected",function(){this.addItems(this.options.items)}.bind(this))}},addItems:function(a){if(this.options.skin){this.options.item.skin=this.options.skin}a.each(function(b){var c=new UI[this.options.itemObject](this.options.item).inject(this.content);$H(b).erase("type").each(function(e,d){var f=new UI.Element({html:e,styles:this.props.components[d].styles}).inject(c.element);this.fireEvent("resize")},this)},this)}});UI.PaneView=new Class({Extends:UI.View,options:{className:"ui-paneview",component:"view",properties:{},styles:{width:"100%",height:"100%",overflow:"hidden"},overflow:"slide",direction:"horizontal",transitionType:"scroll",transitionFx:{transition:Fx.Transitions.Quad.easeOut,duration:300,wait:false},pane:{className:"ui-paneview-pane",styles:{"float":"left",width:"200px",height:"100%"}},onTransition:$empty},build:function(){this.list=[];this.parent();this.setBehaviour()},setBehaviour:function(){this.transitionFx=new Fx.Scroll(this.element,this.options.transitionFx)},add:function(){var a=new UI.View(this.options.pane).inject(this.content);this.list.push(a);this.addEvent("resize",function(){a.scrollbar.update()});this.resize();return a},applyTransition:function(a){this.pane=a;if(this.element.getSize().x<this.content.getSize().x){this.transitionFx.toElement(a)}else{}},next:function(){var a=this.list.indexOf(this.pane)+1;if(this.list[a]){this.applyTransition(this.list[a])}},previous:function(){var a=this.list.indexOf(this.pane)-1;if(this.list[a]){this.applyTransition(this.list[a])}},resize:function(){var a=0;this.list.each(function(c,b){a=a+c.element.getSize().x});this.content.setStyle("width",a+"px")},inject:function(a){this.element.inject(a);return this},remove:function(a){a.destroy()},removeAllNext:function(b){var a=this.list.getLast();while(a!=b){this.list.erase(a);a.destroy();a=this.list.getLast()}}});UI.TabView=new Class({Extends:UI.View,options:{component:"tabview",overflow:"hidden"},build:function(){this.list=[];this.parent();this.buildTabs();this.buildView();this.options.tabs.each(function(a){this.add(a)}.bind(this))},buildTabs:function(){var a="";if(this.options.container){a=this.options.container}else{a=this.element}this.tabbar=new UI.Element(this.props.components.tabbar).inject(a)},buildView:function(){this.tabview=new UI.View({overflow:"hidden",styles:{}}).inject(this.content);this.addEvents({injected:function(){this.updateSize();this.tabview.fireEvent("onResize")}})},add:function(c){var a=new UI.View({type:"tab"}).inject(this.tabview).hide();var b=new UI.Button({type:"tab",label:c.name,onClick:function(){if(b==this.tab){return}if(c.url&&!a.element.retrieve("loaded")){a.setContent("ajax",c.url);a.element.store("loaded",true)}a.show();a.scrollbar.update();if(this.view){this.view.hide()}b.options.state="active";if(this.tab){this.tab.options.state="default";this.tab.setState("default")}this.tab=b;this.view=a}.bind(this)});this.addEvent("resize",function(){a.scrollbar.update()});if(c.selected){this.selected=b}this.list.push(b);b.index=this.list.indexOf(b)},setContent:function(c,b,a){this.active.setContent(c,b,a)},setBehavior:function(){this.parent();this.addEvent("injected",function(){var a=this.selected||this.list[0];a.options.state="active";this.list.each(function(b){b.inject(this.tabbar)}.bind(this));a.setState("active");a.fireEvent("click")})},setSize:function(b,a,c){this.parent(b,a,c);this.updateSize();return this},updateSize:function(){element=this.element.getComputedSize();this.tabbarHeight=this.tabbar.getComputedSize().totalHeight;var b=this.tabview.getComputedSize();var a=element.height-this.tabbarHeight-(b.computedBottom+b.computedTop);this.tabview.setStyle("height",a);this.fireEvent("onResize")},setActiveTab:function(a){if(a>0&&a<=this.list.length){this.list[--a].setState("active");this.list[a].fireEvent("click")}},next:function(a){if(a>0&&a<=this.list.length){this.list[--a].setState("active");this.list[a].fireEvent("click")}}});UI.SplitView=new Class({Extends:UI.View,options:{component:"splitview",overflow:"hidden",minSize:20,splitter:true},build:function(){this.parent();this.addEvent("injected",function(){this.size=this.getSize();this.buildViews();if(this.options.splitter){this.buildSplitter()}}.bind(this))},buildViews:function(){this.view=[];var a=new Hash(this.props.views);a.each(function(d,c){var b=new UI.View(d).inject(this.element);this.view.push(b);this[c]=b},this);this.view[1].element.setStyle("width",this.size.x-this.view[0].getSize().x)},buildSplitter:function(){var a=this.props.components.splitter;this.draglimit={x:[this.options.minSize,this.size.x-this.options.minSize],y:[0,0]};this.splitter=new Element("div",a).inject(this.element);this.splitter.makeDraggable({limit:this.draglimit,onDrag:this.updateSize.bind(this)});this.splitter.setStyle("left",this.view[0].getSize().x)},updateSize:function(){this.view[0].element.setStyle("width",this.splitter.getCoordinates().left-this.element.getCoordinates().left);this.view[1].element.setStyle("width",this.size.x-this.view[0].element.getSize().x);this.fireEvent("resize")}});UI.Window=new Class({Extends:UI.Element,options:{component:"window",title:"Window",width:640,height:480,location:"cascade",position:"fixed",top:false,left:false,right:false,bottom:false,zIndex:"auto",tag:"div",head:true,view:{},foot:true,controls:["close","minimize","maximize"],scrollbar:true,useEffects:false,draggable:true,dragLimitX:[-1000,window.getWidth()+1000],dragLimitY:[51,window.getHeight()+1000],dragHandlers:["head","foot"],hideOnDrag:false,resizable:true,resizeLimitX:[200,Window.getWidth()],resizeLimitY:[200,Window.getHeight()],resizeOnDragIfMaximized:false,onMinimize:$empty,onMaximize:$empty,onRestore:$empty,onLoad:$empty,onBlur:$empty,onFocus:$empty,onClose:$empty},initialize:function(b){this.parent(b);var a=this.getInitialLocation();this.options.top=a.top;this.options.left=a.left;this.element.setStyles(a);this.adaptLocation();if(this.options.position=="fixed"){this.props.styles.position="fixed";this.element.setStyle("position","fixed")}ui.controller.window.register(this);ui.controller.window.focus(this)},build:function(){this.parent();this.buildHead();this.buildView();this.buildFoot();this.inject(this.options.container||$(document.body));if(this.paint){this.paint.canvas.addEvent("click",function(a){ui.controller.window.propagateUnderShadow(a)})}},buildHead:function(){this.head=new Element("div",this.props.components.head).inject(this.element);this.dragHandlers.push(this.head);this.head.disableSelect();if(this.options.skin){this.props.components.title.skin=this.options.skin}this.props.components.title.skin=this.options.skin;this.title=new UI.Label(this.props.components.title).inject(this.head);this.setTitle(this.options.title);this.buildControls(this.options.controls)},buildControls:function(){if(!this.options.controls){return}var a=[];this.controls=new Element("div",this.props.components.controls).addEvent("click",function(b){b.stop()}).inject(this.head);this.options.controls.each(function(c){this.props.components.control.type=c;this.props.components.control.skin=this.options.skin;var b=new UI.Button(this.props.components.control).addEvent("onClick",this.control.bind(this,c)).inject(this.controls);a.push(b)},this);this.addEvents({onMinimize:function(){this.controls.hide()},onNormalize:function(){this.controls.show()}})},buildToolbar:function(b){b.skin=this.options.skin;this.toolbar=new UI.Toolbar(b).inject(this.head);if(this.paint){this.props.layers.head.size[1]=this.head.getSize().y}this.props.components.toggle.skin=this.options.skin;var a=new UI.Button(this.props.components.toggle).addEvent("onClick",this.toggleInterface.bind(this)).inject(this.head);this.addEvents({onMinimize:function(){this.toolbar.element.hide();a.hide()},onNormalize:function(){this.toolbar.element.show();a.show()}});this.updateSize();this.fireEvent("render",this.state);return this},buildView:function(){if(this.options.tabView){this.buildTabview()}else{if(this.options.skin){this.options.view.skin=this.options.skin}if(!this.options.view.type){this.options.view.type=this.props.components.view.type}this.options.view.overflow=this.options.overflow;var a=$merge(this.props.components.view,this.options.view);a.skin=this.options.skin;this.view=new UI.View(a).inject(this.element)}this.addEvents({injected:function(){this.view.fireEvent("onResize")},onMinimize:function(){this.view.hide()},onNormalize:function(){this.view.show();this.setSize()}});this.content=this.view.content},buildTabview:function(){var a=this.options.tabView;this.options.tabView.container=this.element;this.options.tabView.skin=this.options.skin;this.view=new UI.TabView(this.options.tabView).inject(this.element)},buildFoot:function(){if(!this.options.foot||this.foot){return}this.foot=new Element("div",this.props.components.foot).inject(this.element);this.foot.disableSelect();this.status=new Element("div",this.props.components.status).inject(this.foot);this.dragHandlers.push(this.status);this.setStatus();this.addEvents({onMinimize:function(){this.foot.hide()},onNormalize:function(){this.foot.show()}})},buildResizer:function(){this.parent();this.addEvents({minimize:function(){this.resizer.hide()},normalize:function(){this.resizer.show()}})},toggleInterface:function(){if(this.toolbar.element.getStyle("display")=="block"){if(this.paint){this.props.layers.head.size[1]=this.head.getSize().y}this.toolbar.element.hide()}else{this.toolbar.element.setStyles({opacity:1,visibility:"visible",display:"block"});if(this.paint){this.props.layers.head.size[1]=this.head.getSize().y}}if(this.foot){if(this.foot.getStyle("display")=="block"){this.foot.hide()}else{this.foot.setStyles({opacity:1,visibility:"visible",display:"block"})}}this.updateSize();this.setSize(this.element.x,this.element.y);this.fireEvent("onResizeDrag");this.fireEvent("render",this.state);return this},setBehavior:function(){this.parent();this.setStyle("position","fixed");this.addEvents({mousedown:this.focus.bind(this),resizeComplete:function(){this.maximized=false;var a=this.element.getCoordinates();this.options.width=a.width;this.options.height=a.height}.bind(this)});this.addEvents({onBlur:function(){if(this.view.iframe){this.view.overlay.show()}this.controls.setStyle("opacity",".49")},onFocus:function(){if(this.view.iframe){this.view.overlay.hide()}if(this.controls){this.controls.setStyle("opacity",".99")}},onResizeStart:function(){if(this.view.iframe){this.view.overlay.show()}},onResizeComplete:function(){if(this.view.iframe){this.view.overlay.hide()}},onDragStart:function(){if(this.options.hideOnDrag){this.view.hide()}else{if(this.view.iframe){this.view.overlay.show()}}},onDragComplete:function(){if(this.options.hideOnDrag){this.view.show()}else{if(this.view.iframe){this.view.overlay.hide()}}}})},enableDrag:function(){this.parent();this.addEvents({onDragComplete:function(){this.options.location="custom";this.maximized=false;var a=this.element.getCoordinates();this.options.top=a.top;this.options.left=a.left;this.options.width=a.width;this.options.height=a.height}.bind(this)});this.element.setStyle("position","absolute")},focus:function(){if(this.minimized){this.normalize();ui.controller.window.resetMinimizedLocation()}else{if(this.maximized&&this.options.resizeOnDragIfMaximized){this.normalize()}else{ui.controller.window.focus(this)}}if(this.state!="default"){this.setState("default")}},minimize:function(){this.fireEvent("onMinimize");this.maximized=false;this.minimized=true;var a={width:this.skin.minimized.width,height:this.skin.minimized.height};this.setSize(a.width,a.height,"minimized");this.setState("minimized",a);var b=ui.controller.window.getMinimizedLocation();this.setLocation(b[0],b[1]);this.setStyle("position","fixed");ui.controller.window.focus()},maximize:function(){if(this.maximized){this.normalize()}else{var b=Window.getWidth()-this.computedSize.computedLeft-this.computedSize.computedRight;var a=Window.getHeight()-this.options.dragLimitY[0]-this.computedSize.computedBottom-this.computedSize.computedTop;this.setSize(b,a);var c=this.getCoordinates();this.computedSize.computedLeft;this.options.top=c.top;this.options.left=c.left-this.computedSize.computedLeft;this.element.setStyles({top:this.options.dragLimitY[0],left:0});this.minimized=false;this.maximized=true;this.fireEvent("onMaximize");this.fireEvent("onResizeDrag")}},normalize:function(){this.fireEvent("onNormalize");var a={width:false,height:false};this.updateSize();this.setState("default",a);this.setLocation();ui.controller.window.focus(this);this.maximized=false;this.minimized=false;this.fireEvent("onResizeDrag")},getInitialLocation:function(){if(this.options.top||this.options.right||this.options.bottom||this.options.left){var b=(this.options.right&&!this.options.left)?Window.getWidth()-this.options.right-this.options.width:this.options.left;var a=(this.options.bottom&&!this.options.top)?Window.getHeight()-this.options.bottom-this.options.height:this.options.top;return{top:a,left:b}}else{if(this.options.location=="center"){return this.getCenterLocation()}else{var d=ui.controller.window.getCascadeLocation(this);return{top:d.top,left:d.left}}}},updateSize:function(){element=this.element.getComputedSize();if(this.options.head&&!this.headSize){this.headHeight=this.head.getComputedSize().totalHeight}if(this.options.foot&&!this.footSize){this.footHeight=this.foot.getComputedSize().totalHeight}if(this.options.tabView){this.view.tabbar.setStyle("width",element.x)}if(this.paint&&this.props.layers.head.size){this.props.layers.head.size[1]=this.head.getSize().y;this.skin.inactive.layers.head.size[1]=this.head.getSize().y}var b=this.view.element.getComputedSize();var a=element.height-this.headHeight-this.footHeight-(b.computedBottom+b.computedTop);this.view.setStyle("height",a);this.view.fireEvent("onResize")},setSize:function(b,a,c){this.parent(b,a,c);this.updateSize();return this},setTitle:function(a){return this.title.set("html",a)},setContent:function(c,b,a){return this.view.setContent(c,b,a)},setStatus:function(a){this.status.set("html",a);return this},control:function(a){this[a]();return this},close:function(){ui.controller.window.close(this);this.fireEvent("onClose")}});ui.controller.window={options:{version:"0.1a",zBase:2000,zStep:1,cascade:{start:{x:51,y:101},step:{x:20,y:20},offset:[170,50]},stack:{offsetWidth:4,offsetHeight:4}},start:function(){this.list=[];this.zIndex=this.options.zBase;window.addEvent("resize",function(){this.resizeMaximizedWindow()}.bind(this))},register:function(a){this.list.push(a);if(a.options.zIndex=="auto"){a.element.setStyle("zIndex",this.zIndex)}else{a.element.setStyle("zIndex",a.options.zIndex)}this.zIndex+=this.options.zStep},close:function(b){b=b||this.active;b.hide();b.fireEvent("onClose");for(var a=this.list.length-1;a>=0;a--){if(this.list[a]==b){b.destroy();delete this.list[a];this.list=this.list.clean()}}this.focus()},focus:function(c){if(!$defined(c)){var e=0;var b;for(var a=this.list.length-1;a>=0;a--){var d=this.list[a].element.getStyle("zIndex");if(d>=e&&!this.list[a].minimized){b=this.list[a];e=d}}if(b){b.focus()}return}else{if(c&&this.active!=c){if(this.active&&!this.active.minimized){this.blur(this.active)}this.zIndex+=this.options.zStep;c.element.style.zIndex=this.zIndex;this.active=c;c.fireEvent("focus");return}}},blur:function(a){if($defined(a)&&!a.minimized){a.setState("inactive");a.fireEvent("onBlur")}else{if(this.active){this.blur(this.active)}}},minimize:function(){this.active.minimize()},getMinimizedLocation:function(){var a=-150;var b=window.getHeight()-35;this.list.each(function(c,d){if(c.state=="minimized"){a+=c.getStyle("width").toInt()+8}});return[a,b]},resetMinimizedLocation:function(){var a=-150;var b=window.getHeight()-35;this.list.each(function(c){if(c.state=="minimized"){a+=c.getStyle("width").toInt()+4;c.setLocation(a,b)}})},resizeMaximizedWindow:function(){this.list.each(function(a){if(a.state=="maximized"){a.setSize({height:window.getHeight()-53,width:window.getWidth()})}})},getCascadeLocation:function(b){var a={left:71,top:121};this.list.each(function(c,d){if(c.state!="minimized"&&c.options.location=="cascade"){a.left+=this.options.cascade.step.x;a.top+=this.options.cascade.step.y}},this);return a},propagateUnderShadow:function(c){var a=c.client.x;var f=c.client.y;var d=0;var b="";this.list.each(function(g,e){var h=g.element.getCoordinates();if(h.left<=a&&a<=h.left+h.width&&h.top<=f&&f<h.top+h.height){if(g.element.getStyle("z-index")>d){d=g.element.getStyle("z-index");b=g}b.focus()}})},cascade:function(b){var e=[51,101];var c=[20,20];var d=this.zIndex;var a;this.list.each(function(f){if(f.state!="minimized"){f.element.style.zIndex=d++;e[0]+=c[0];e[1]+=c[1];f.element.morph({left:e[0],top:e[1]});f.location="cascade";a=f}});this.zIndex=d},closeAll:function(){this.list.each(function(a){this.close(a)},this)}};ui.controller.window.start();UI.Dialog=new Class({Extends:UI.Window,options:{center:true,title:"Dialog",width:480,height:200,head:true,controls:["close"],view:{},foot:false,message:"message",location:"center",scrollbar:false,resizable:false,buttons:[]},build:function(){this.buildUnderlay();this.parent();this.element.setStyle("zIndex","1000");this.buildMessage();this.buildButtons()},buildUnderlay:function(){this.underlay=new Element("div",{styles:{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",opacity:".2",backgroundColor:"#000",zIndex:"999"}}).inject($(document.body));this.addEvent("onClose",function(){this.underlay.destroy()})},buildMessage:function(){this.message=new Element("div").setStyles({padding:"20px"}).set("html",this.options.message).inject(this.content)},buildButtons:function(){this.buttons=new Element("div",this.props.components.controls);this.options.buttons.each(function(b){this.props.components.control.type=b;var a=new UI.Button(this.props.components.control).addEvent("onClick",this.control.bind(this,b)).inject(this.controls)},this)}});UI.Panel=new Class({Extends:UI.Window,options:{component:"window",type:"panel",title:"Panel",width:280,height:400,url:false,location:"cascade",top:0,left:0,zIndex:"auto",tag:"div",head:true,view:true,foot:false,controls:["close","minimize","maximize"],useEffects:false,viewOverflow:"hidden",scrollbar:false,draggable:true,dragLimitX:[-1000,window.getWidth()+1000],dragLimitY:[0,window.getHeight()+1000],dragHandlers:["head"],resizable:true,resizeLimitX:[200,window.getWidth()],resizeLimitY:[200,window.getHeight()]},build:function(){this.parent()},updatecInnerSize:function(){var e=this.frame.getSize();var c=this.options.borderSize;var a=c*2;var b=0;if(this.options.useHead){b=b+this.options.styles.head.height}if(this.options.useFoot){b=b+this.options.styles.foot.height}var d=e.y-b;if(this.options.useHead){this.head.setStyles({width:e.x-a})}this.view.wrapper.setStyles({width:e.x-a,height:d-a});if(this.options.useFoot){this.foot.setStyles({bottom:c,width:e.x-a})}this.drawCanvas()}});